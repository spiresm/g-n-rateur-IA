<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>G√©n√©rateur Premium IA - Corrig√©</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css"> 
    <style>
        /* Styles minimalistes pour l'affichage si styles.css est manquant */
        body { font-family: sans-serif; background: #f4f4f5; color: #333; margin: 0; padding: 20px; }
        .app-shell { max-width: 1400px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        header { padding: 20px; background: #1e293b; color: white; display: flex; justify-content: space-between; align-items: center; border-radius: 12px 12px 0 0; }
        .title-group h1 { margin: 0; font-size: 1.5rem; }
        .layout { display: flex; gap: 20px; padding: 20px; }
        .panel { flex: 1; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; }
        .mode-selector { display: flex; gap: 10px; padding: 20px; }
        .mode-card { flex: 1; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .mode-card.active { border-color: #4f46e5; background: #eef2ff; }
        .btn-main { background: #4f46e5; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; width: 100%; }
        .btn-secondary { background: #f1f5f9; color: #333; border: 1px solid #ccc; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .ui-input, .ui-select, .textarea { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .textarea { min-height: 80px; resize: vertical; }
        .menu-title { border-bottom: 1px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 15px; }
        .log-box { background: #f8fafc; border: 1px solid #e5eeef; padding: 10px; max-height: 200px; overflow-y: auto; font-size: 0.8rem; border-radius: 4px; }
        .log-entry { margin-bottom: 5px; color: #333; }
        .log-error { color: #ef4444; }
        .log-success { color: #10b981; }
        .field-group { margin-bottom: 15px; }
        .dual-field { display: flex; gap: 10px; margin-bottom: 15px; }
        .dual-field > div, .dual-field > input { flex: 1; }
        .dual-field label { display: block; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .pill-green { background: #10b981; color: white; padding: 4px 8px; border-radius: 9999px; font-size: 0.75rem; }
        .format-select { display: flex; gap: 10px; margin-bottom: 15px; }
        .format-option { flex: 1; text-align: center; padding: 8px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        .format-option.active { border-color: #4f46e5; background: #eef2ff; }
    </style>
</head>

<body>
<div class="app-shell">

    <header>
        <div class="title-group">
            <h1>G√©n√©rateur IA Premium</h1>
            <div class="title-chip">
                <span></span>
                Interface Luxe ‚Ä¢ Mode Avanc√©
            </div>
        </div>

        <div class="gpu-card" id="gpu-card">
            <div class="gpu-main">
                <span class="gpu-label">GPU</span>
                <strong id="gpu-name">‚Äì</strong>
                <div class="gpu-pills">
                    <div class="gpu-pill"><span id="gpu-util">0%</span> ‚Ä¢ Utilisation</div>
                    <div class="gpu-pill"><span id="gpu-mem">0 / 0 Go</span></div>
                </div>
            </div>
            <div class="gpu-status-indicator">
                <div class="gpu-dot"></div>
                <div class="gpu-value" id="gpu-temp">‚Äì ¬∞C</div>
            </div>
        </div>
    </header>

    <div class="mode-selector">
        <div class="mode-card active" data-mode="affiche" id="mode-affiche">
            <div class="mode-icon">üé¨</div>
            <h2>Cr√©er une Affiche</h2>
            <p>Construis une affiche cin√©ma styl√©e et riche.</p>
        </div>

        <div class="mode-card" data-mode="image" id="mode-image">
            <div class="mode-icon">üñºÔ∏è</div>
            <h2>Cr√©er une Image</h2>
            <p>G√©n√®re une image IA artistique ou r√©aliste.</p>
        </div>
    </div>

    <hr class="separator">


    <div class="layout">

        <div class="panel">
            <form id="generation-form-premium">

                <div id="affiche-menu" class="menu-premium" style="display:block;">
                    <h3 class="menu-title">üé¨ Cr√©ation d'Affiche</h3>
                    <p class="menu-sub">Personnalisez chaque aspect pour une affiche cin√©matographique premium.</p>

                    <button type="button" id="affiche-random-btn" class="btn-secondary" style="width: 100%; margin-bottom: 15px;">
                        üé≤ G√©n√©rer une Affiche Al√©atoire
                    </button>

                    <div class="field-group">
                        <label>Titre</label>
                        <input id="aff_titre" name="aff_titre" class="ui-input" type="text" placeholder="Ex : LA GRANDE AVENTURE">
                    </div>

                    <div class="field-group">
                        <label>Sous-titre</label>
                        <input id="aff_sous_titre" name="aff_sous_titre" class="ui-input" type="text" placeholder="Ex : La magie commence ici‚Ä¶">
                    </div>

                    <div class="field-group">
                        <label>Tagline (bas de l‚Äôaffiche)</label>
                        <input id="aff_tagline" name="aff_tagline" class="ui-input" type="text" placeholder="Ex : Une aventure inoubliable‚Ä¶">
                    </div>

                    <hr class="separator">

                    <div class="dual-field">
                        <div>
                            <label>Occasion / Th√®me</label>
                            <select id="aff_theme" name="aff_theme" class="ui-select">
                                <option value="">Choisir un th√®me</option>
                                <option value="Cyberpunk Cityscape">Ville Cyberpunk</option>
                                <option value="Medieval Fantasy">Fantaisie m√©di√©vale</option>
                                <option value="Deep Space Exploration">Exploration spatiale</option>
                            </select>
                        </div>
                        <input id="aff_theme_custom" name="aff_theme_custom" class="ui-input custom-field" type="text" placeholder="Votre propre th√®me‚Ä¶">
                    </div>

                    <div class="dual-field">
                        <div>
                            <label>Ambiance g√©n√©rale</label>
                            <select id="aff_ambiance" name="aff_ambiance" class="ui-select">
                                <option value="">Choisir une ambiance</option>
                                <option value="Dramatic and Dark">Dramatique et sombre</option>
                                <option value="Whimsical and Colorful">F√©√©rique et color√©e</option>
                                <option value="Tense and Noir">Tendue et film noir</option>
                            </select>
                        </div>
                        <input id="aff_ambiance_custom" name="aff_ambiance_custom" class="ui-input custom-field" type="text" placeholder="D√©crivez votre ambiance‚Ä¶">
                    </div>

                    <hr class="separator">

                    <div class="dual-field">
                        <div>
                            <label>Personnage principal</label>
                            <select id="aff_perso_sugg" name="aff_perso_sugg" class="ui-select">
                                <option value="">Choisir un personnage</option>
                                <option value="A lone samurai">Un samoura√Ø solitaire</option>
                                <option value="A young sorceress">Une jeune sorci√®re</option>
                                <option value="An astronaut">Un astronaute</option>
                            </select>
                        </div>
                        <input id="aff_perso_desc" name="aff_perso_desc" class="ui-input custom-field" type="text" placeholder="Description personnalis√©e‚Ä¶">
                    </div>

                    <div class="dual-field">
                        <div>
                            <label>Environnement</label>
                            <select id="aff_env_sugg" name="aff_env_sugg" class="ui-select">
                                <option value="">Choisir un environnement</option>
                                <option value="Mountain top temple">Temple au sommet d'une montagne</option>
                                <option value="Haunted forest">For√™t hant√©e</option>
                                <option value="Deserted planet">Plan√®te d√©sertique</option>
                            </select>
                        </div>
                        <input id="aff_env_desc" name="aff_env_desc" class="ui-input custom-field" type="text" placeholder="Votre environnement‚Ä¶">
                    </div>

                    <div class="dual-field">
                        <div>
                            <label>Action du personnage</label>
                            <select id="aff_action_sugg" name="aff_action_sugg" class="ui-select">
                                <option value="">Choisir une action</option>
                                <option value="Fights a dragon">Combat un dragon</option>
                                <option value="Looks at the sunrise">Regarde le lever du soleil</option>
                                <option value="Hacking a terminal">Piratage d'un terminal</option>
                            </select>
                        </div>
                        <input id="aff_action_desc" name="aff_action_desc" class="ui-input custom-field" type="text" placeholder="Description personnalis√©e‚Ä¶">
                    </div>

                    <hr class="separator">

                    <div class="field-group">
                        <label>D√©tails suppl√©mentaires</label>
                        <textarea id="aff_details" name="aff_details" class="ui-input textarea" placeholder="Ex : fum√©e, reflets, lumi√®re dramatique‚Ä¶"></textarea>
                    </div>

                    <hr class="separator">

                    <div class="dual-field">
                        <div>
                            <label>Palette</label>
                            <select id="aff_palette" name="aff_palette" class="ui-select">
                                <option value="">Choisir une palette</option>
                                <option value="Neon blue and pink">Bleu n√©on et rose</option>
                                <option value="Sepia tones">Tons s√©pia</option>
                                <option value="Vibrant primary colors">Couleurs primaires vibrantes</option>
                            </select>
                        </div>
                        <input id="aff_palette_custom" name="aff_palette_custom" class="ui-input custom-field" type="text" placeholder="Palette personnalis√©e‚Ä¶">
                    </div>

                    <div class="dual-field">
                        <div>
                            <label>Style du titre</label>
                            <select id="aff_style_titre" name="aff_style_titre" class="ui-select">
                                <option value="">Choisir un style</option>
                                <option value="Retro 80s block font">Police r√©tro ann√©es 80</option>
                                <option value="Elegant script font">Police manuscrite √©l√©gante</option>
                                <option value="Sci-fi technological font">Police sci-fi technologique</option>
                            </select>
                        </div>
                        <input id="aff_style_titre_custom" name="aff_style_titre_custom" class="ui-input custom-field" type="text" placeholder="Style personnalis√©‚Ä¶">
                    </div>

                    <button type="button" id="affiche-generate-btn" class="btn-main" style="margin-top: 15px;">
                        ‚ú® G√©n√©rer le Prompt de l‚ÄôAffiche
                    </button>

                </div>


                <div id="image-menu" class="menu-premium" style="display:none;">
                    <h3 class="menu-title">üñºÔ∏è G√©n√©ration d‚ÄôImage</h3>
                    <p class="menu-sub">Cr√©ez une image IA de haute qualit√© √† partir d‚Äôun prompt d√©taill√©.</p>

                    <div class="field-group">
                        <label>Prompt principal</label>
                        <textarea id="image-input-prompt" name="prompt" class="ui-input textarea" style="min-height:130px;" placeholder="D√©crivez l'image que vous souhaitez g√©n√©rer ici."></textarea>
                    </div>

                    <hr class="separator">

                    <div class="field-group">
                        <label>Image de r√©f√©rence (optionnel)</label>
                        <button type="button" id="input-image-browse-btn" class="btn-secondary">üñºÔ∏è Importer une image‚Ä¶</button>
                        <span id="input-image-label" class="file-label">Aucune image s√©lectionn√©e</span>
                        <input id="input-image-file" type="file" accept="image/*" style="display:none;">
                    </div>
                </div>

            </form>
        </div>


<div class="panel">

    <div class="panel-header">
        <div class="panel-title">
            <span class="icon">üñºÔ∏è</span>
            <div>
                R√©sultat
                <div class="panel-sub">Pr√©visualisation & image finale</div>
            </div>
        </div>
        <span class="pill-green" id="job-status-pill">READY</span>
    </div>

    <button id="generate-button-right-panel" 
            class="btn-main" 
            type="submit" 
            form="generation-form-premium" 
            style="margin-bottom: 18px;">
        üöÄ G√©n√©rer l‚Äôimage
    </button>

    <div class="format-select">
        <div class="format-option active" data-format="square">‚ñ¢ Carr√©</div>
        <div class="format-option" data-format="portrait">‚ñØ Portrait</div>
        <div class="format-option" data-format="landscape">‚ñ¨ Paysage</div>
    </div>

    <div id="result-area">
        <div id="progress-overlay" style="display:none;">
            <div id="progress-spinner"></div>
            <div id="progress-meta">
                <span id="progress-label">En attente‚Ä¶</span>
                <span id="progress-percent">0%</span>
            </div>

            <div class="progress-bar-large">
                <div class="progress-inner-large" id="progress-inner"></div>
            </div>
        </div>

        <div id="result-placeholder">
            <p>Aucune image encore g√©n√©r√©e.</p>
        </div>
    </div>

    <div class="panel-subtitle">üéØ Prompt g√©n√©r√©</div>
    <textarea id="generated-prompt-output" class="ui-input textarea" style="min-height:130px;" readonly placeholder="Le prompt d√©taill√© sera affich√© ici apr√®s g√©n√©ration (mode Affiche) ou avant l'envoi (mode Image)."></textarea>

    <div class="panel-subtitle">üìú Console</div>
    <div id="log-container" class="log-box"></div>

    <div id="result-footer" style="margin-top: 18px;">
        <button type="button" id="copy-params-btn" class="btn-secondary">
            üìã Copier les param√®tres
        </button>
    </div>

</div>


<div id="image-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <img id="modal-image" src="" alt="Image HD">
        <a id="modal-download-link" href="#" download class="btn-secondary">T√©l√©charger l‚Äôimage</a>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('generation-form-premium');
        const afficheMenu = document.getElementById('affiche-menu');
        const imageMenu = document.getElementById('image-menu');
        const modeCards = document.querySelectorAll('.mode-card');
        const afficheGenerateBtn = document.getElementById('affiche-generate-btn');
        const generatedPromptOutput = document.getElementById('generated-prompt-output');
        const logContainer = document.getElementById('log-container');
        const jobStatusPill = document.getElementById('job-status-pill');
        const imageInputPrompt = document.getElementById('image-input-prompt');
        const formatOptions = document.querySelectorAll('.format-option');
        
        // --- 1. FONCTION DE LOGGING ---
        function logToConsole(message, type = 'info') {
            const entry = document.createElement('div');
            entry.classList.add('log-entry', `log-${type}`);
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.prepend(entry);
        }

        // --- 2. GESTION DES MODES (AFFICHE / IMAGE) ---
        modeCards.forEach(card => {
            card.addEventListener('click', () => {
                modeCards.forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                const mode = card.getAttribute('data-mode');

                afficheMenu.style.display = mode === 'affiche' ? 'block' : 'none';
                imageMenu.style.display = mode === 'image' ? 'block' : 'none';
                logToConsole(`Mode s√©lectionn√© : <strong>${mode.toUpperCase()}</strong>.`);
            });
        });

        // --- 3. GESTION DES FORMATS ---
        formatOptions.forEach(option => {
            option.addEventListener('click', () => {
                formatOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                logToConsole(`Format s√©lectionn√© : ${option.getAttribute('data-format')}.`);
            });
        });

        // --- 4. LOGIQUE DE CONSTRUCTION DU PROMPT AFFICHE ---
        function buildAffichePrompt() {
            // Fonction pour obtenir la valeur d'un champ ou sa version custom
            function getFieldValue(id) {
                const customId = `${id}_custom`;
                const customValue = document.getElementById(customId)?.value;
                const selectValue = document.getElementById(id)?.value;
                return customValue || selectValue;
            }

            const elements = [
                document.getElementById('aff_titre').value ? `Titre de l'oeuvre: "${document.getElementById('aff_titre').value}".` : '',
                document.getElementById('aff_sous_titre').value ? `Sous-titre: "${document.getElementById('aff_sous_titre').value}".` : '',
                getFieldValue('aff_theme') ? `Th√®me: ${getFieldValue('aff_theme')}.` : '',
                getFieldValue('aff_ambiance') ? `Ambiance: ${getFieldValue('aff_ambiance')}.` : '',
                getFieldValue('aff_perso_sugg') ? `Personnage: ${getFieldValue('aff_perso_sugg')}.` : '',
                getFieldValue('aff_env_sugg') ? `Environnement: ${getFieldValue('aff_env_sugg')}.` : '',
                getFieldValue('aff_action_sugg') ? `Action: ${getFieldValue('aff_action_sugg')}.` : '',
                document.getElementById('aff_details').value ? `D√©tails techniques: ${document.getElementById('aff_details').value}.` : '',
                getFieldValue('aff_palette') ? `Palette de couleurs: ${getFieldValue('aff_palette')}.` : '',
                "Style: Affiche de film cin√©matographique, haute r√©solution, √©clairage dramatique, composition en plong√©e."
            ];
            
            return elements.filter(e => e).join(' ');
        }

        // √âv√©nement pour le bouton "G√©n√©rer le Prompt de l‚ÄôAffiche"
        afficheGenerateBtn.addEventListener('click', () => {
            const prompt = buildAffichePrompt();
            if (prompt.trim().length > 100) {
                generatedPromptOutput.value = prompt;
                logToConsole("Le prompt de l'affiche a √©t√© g√©n√©r√© et affich√©.", "success");
            } else {
                generatedPromptOutput.value = '';
                logToConsole("Le prompt est trop court. Remplissez plus de champs pour le mode Affiche.", "error");
            }
        });

        // --- 5. GESTION DE LA SOUMISSION DU FORMULAIRE (Bouton "G√©n√©rer l'image") ---
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Emp√™che le rechargement de la page
            
            const activeMode = document.querySelector('.mode-card.active').getAttribute('data-mode');
            let finalPrompt = '';

            // 1. D√©terminer le prompt √† utiliser
            if (activeMode === 'affiche') {
                // On s'assure que le prompt est g√©n√©r√© avant l'envoi
                finalPrompt = generatedPromptOutput.value || buildAffichePrompt();
            } else if (activeMode === 'image') {
                // Si mode Image, on prend le prompt saisi directement
                finalPrompt = imageInputPrompt.value;
            }

            if (!finalPrompt || finalPrompt.trim().length < 5) {
                logToConsole("ERREUR: Le prompt est vide. Veuillez saisir un texte ou g√©n√©rer l'affiche.", "error");
                jobStatusPill.textContent = 'ERROR';
                jobStatusPill.style.backgroundColor = '#ef4444';
                return;
            }

            // 2. Afficher/Confirmer le prompt final dans la zone de r√©sultat
            generatedPromptOutput.value = finalPrompt;

            // 3. Simuler le processus de g√©n√©ration
            jobStatusPill.textContent = 'IN PROGRESS';
            jobStatusPill.style.backgroundColor = '#f59e0b'; // Jaune
            document.getElementById('progress-overlay').style.display = 'block';

            logToConsole(`Lancement de la t√¢che pour le mode ${activeMode.toUpperCase()}...`);
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                if (progress >= 100) {
                    clearInterval(interval);
                    document.getElementById('progress-overlay').style.display = 'none';
                    logToConsole("G√©n√©ration de l'image termin√©e avec succ√®s !", "success");
                    jobStatusPill.textContent = 'COMPLETE';
                    jobStatusPill.style.backgroundColor = '#10b981'; // Vert
                    // Ici, vous afficheriez l'image g√©n√©r√©e dans #result-placeholder
                    document.getElementById('result-placeholder').innerHTML = '<img src="placeholder.jpg" alt="Image g√©n√©r√©e" style="width:100%; height:auto; border-radius: 6px;">';
                } else {
                    document.getElementById('progress-percent').textContent = `${progress}%`;
                    document.getElementById('progress-inner').style.width = `${progress}%`;
                    if (progress === 50) {
                         logToConsole("Calcul et pr√©visualisation en cours...", "info");
                    }
                }
            }, 300); // 3 secondes de simulation
        });

        // --- 6. INITIALISATION ---
        logToConsole("Interface charg√©e. Pr√™te pour la g√©n√©ration IA Premium.", "info");
        document.querySelector('.format-option').classList.add('active'); // S√©lectionne le format Carr√© par d√©faut
    });
</script>
</body>
</html>
